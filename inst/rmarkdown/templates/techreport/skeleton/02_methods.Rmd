# Methods

```{r testfig, fig.cap = "Test figure with a caption will be numbered automatically."}
plot(cars)
```

```{r testtab}
d <- structure(list(
  Year = c("2018", "2019", "2020"), 
  `Value 1` = c(1.12, 2.32, 3.67), 
  `Value 2` = c(31.9, 2.8, 112.2)), 
  row.names = c(NA, -3L), class = "data.frame")

csasdown::csas_table(d,
  align = c("c", "r", "r"),
  caption = "Test table with a caption will be numbered automatically.")
```

\clearpage

Next we show a more complicated table with merged rows and text wrapping. Note that this example must be implemented internally in LaTeX, so your text must have any special characters in LaTeX escaped with a backslash (see text in `dat` for examples):

```{r multi-row-table}
dat <- tribble(
  ~`Overarching goal`, ~`Performance metrics`, ~group,
  "Rebuild depleted CUs\n(These performance metrics infer a relatively monotonic trajectory towards a rebuilding target)", "Probability that all red-status CUs rebuild to above their lower rebuilding thresholds (e.g., lower WSP benchmark) within a given time frame.", 1,
  NA, "Probability that any one (or a specified proportion of) red-status CU(s) rebuilds to above its lower rebuilding threshold within a given time frame.", 1,
  NA, "Proportion of red-status CUs that rebuild to above their lower rebuilding thresholds with a specified probability within a given time frame. (Median over MC trials and 95\\% CIs)", 1,
  NA, "Number of years required to achieve lower rebuilding thresholds for one (a proportion of, or all) red-listed CU(s) with a specific probability. (Median over MC trials and 95\\% CIs)", 1,
  
  "Minimize risk of loss\n(These metrics can be duplicated for numerous rebuilding and target thresholds)", "Proportion of years that all CUs are above a quasi-extirpation threshold across the modelled time period. (Median over MC trials and 95\\% CIs)", 2,
  NA, "Proportion of years where all CUs are above their lower rebuilding thresholds within the modelled time period. (Median over MC trials and 95\\% CIs)", 2,
  NA, "Proportion of years where at least one (or a specified \\% of) CU(s) is(are) above their lower rebuilding thresholds within the modelled time period. (Median over MC trials and 95\\% CIs)", 2,
  NA, "Proportion of years where all CUs remain above their lower (or upper) rebuilding threshold across the modelled time period. (Median over MC trials and 95\\% CIs)", 2,
  NA, "Mean spawner abundances over the modelled time-period (or most recent generation) relative to lower rebuilding threshold. (Median over MC trials and 95\\% CIs)", 2,
  NA, "Variation in spawner abundances: CV of (or average \\% change between years in) spawner abundances over the modelled time period. (Median value over MC trials and 95\\% CIs) (suggested as indicator of extinction risk by Wainwright and Waples 1998)", 2,
  
  "Avoid COSEWIC listing", "Short-term trends in spawner biomass over the last three generations. (Median over MC trials and 95\\% CIs) \\emph{COSEWIC Criterion A}", 3,
  NA, "Probability that short-term trends in abundances are > 30\\% (COSEWIC threshold) in the most recent time period. \\emph{COSEWIC Criterion A}", 3,
  NA, "Proportion of years where the short-term trend metrics < 30\\% for all CUs (or specified \\% of CUs). (Median over MC trials and 95\\% CIs) \\emph{COSEWIC Criterion A}", 3,
  NA, "Proportion of years where the short-term trend is stationary or positive and abundances are greater than 10,000. \\emph{COSEWIC Criterion C}", 3,
  NA, "Proportion of years where all CUs are above COSEWIC small population size thresholds, across the entire sampling period. (Median over MC trials and 95\\% CIs). \\emph{COSEWIC Criterion D}", 3,

  "Maintain exploitation rates below sustainable levels", "Mean exploitation rate relative to current $U_{MSY}$ for over the modelled time period. (Median value over MC trials and 95\\% CIs)", 4,

  "Maximize catch and stability in catch", "Proportion of years that mean catch for the CU-aggregate is above a minimum acceptable level over the entire sampling period, in the short term (first 1-2 generations), or in the long term (last 1-2 generations). (Median value over MC trials and 95\\% CIs)", 5,
  NA, "Mean catch over the entire sampling period, in the short term (first 1-2 generations), or in the long term (last 1-2 generations), for totals and segregated into different fisheries (e.g., mixed-CU vs. terminal). (Median value over MC trials and 95\\% CIs)", 5,
  NA, "Catch variability: CV of (or average \\% change between years in) catch over the sampling period, for totals and segregated into different fisheries (e.g., mixed vs. terminal). (Median value over MC trials and 95\\% CIs)", 5,

  "Allocate catch to terminal vs. mixed-CU fisheries", "Proportion of catch in mixed-CU vs terminal fisheries averaged over the entire sampling period (Median value over MC trials and 95\\% CIs)", 6)

dat %>% 
  mutate_all(kableExtra::linebreak) %>% 
  group_by(group) %>% 
  mutate(`Overarching goal` = first(`Overarching goal`)) %>% 
  ungroup() %>% 
  select(-group) %>% 
  group_by(`Overarching goal`) %>%
  csasdown::csas_table(format = "latex",
                       repeat_header = TRUE,
                       #hold_position = TRUE,
                       escape = FALSE) %>%
  kableExtra::column_spec(column = 1, width = "15em") %>%
  kableExtra::column_spec(column = 2, width = "30em") %>%
  kableExtra::collapse_rows(1, valign = "top")
  
```

See Table \@ref(tab:testtab) for the example table.

See Figure \@ref(fig:testfig) for the example figure.

\clearpage

<!-- clearpage ends the page, and also dumps out all floats.
Floats are things like tables and figures. -->
```{r widelong, results = "asis"}
yrs <- 1:45
ages <- 1:15
widelong <- matrix(round(rnorm(length(yrs) * length(ages), 20), 4),
  nr = length(yrs),
  nc = length(ages),
  dimnames = list(year = yrs, age = ages))
widelong_df <- data.frame(cbind(yrs, widelong))

# In landscape tables, you can change the font size if the table
# is too large and overlaps the header and footer lines.
csasdown::csas_table(widelong_df,
  col.names = c("Year", as.character(ages)),
  caption = "A long and wide table",
  format = "latex",
  landscape = TRUE,
  font_size = 8)
```

\clearpage
